<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Purin Minesweeper</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’£</text></svg>">
<style>
  :root{
    --bg:#c0c0c0;
    --panel:#e0e0e0;
    --bevel1:#ffffff;
    --bevel2:#a3a3a3;
    --window-width:980px;
    --cell-size:36px;
  }
  html,body{height:100%;margin:0;font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#9fb3d6,#cbdcf0);-webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
  .app{min-height:100%;display:flex;align-items:center;justify-content:center;padding:18px;box-sizing:border-box;}
  .board-wrap{width:100%;max-width:var(--window-width);background:linear-gradient(var(--panel), #dcdcdc);border-radius:6px;box-shadow: 0 8px 24px rgba(3,12,30,0.15);padding:18px;display:flex;flex-direction:column;align-items:center;gap:12px;}

/* Header bar like classic minesweeper */
.header{display:flex;align-items:center;gap:12px;}
.title{font-weight:700;font-size:18px;color:#1f2937;margin-right:8px;}
.controls{display:flex;gap:12px;align-items:center;}
.control-panel{display:flex;align-items:center;gap:8px;background:linear-gradient(#e8e8e8,#cfcfcf);padding:8px;border-radius:6px;border:1px solid #9a9a9a;box-shadow: inset 2px 2px 0 rgba(255,255,255,0.6), inset -2px -2px 0 rgba(0,0,0,0.06);}

/* Mine counter and timer - 3-digit LED style */
.led{font-family: monospace;background:#200;color:#ff2a2a;padding:6px 8px;border-radius:4px;min-width:54px;text-align:center;font-weight:700;box-shadow: inset 0 -3px 0 rgba(0,0,0,0.2);}
.difficulty{padding:6px 8px;border-radius:6px;border:1px solid #bdbdbd;background:#f7f7f7;cursor:pointer;}

/* Smile/reset button */
.reset-btn{width:44px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:6px;border:2px solid var(--bevel2);background:linear-gradient(var(--bevel1),var(--bevel2));cursor:pointer;font-size:20px;box-shadow: inset 2px 2px 0 rgba(255,255,255,0.6), inset -2px -2px 0 rgba(0,0,0,0.06);}

/* Board area: responsive square grid */
.board-area{width:100%;display:flex;align-items:center;justify-content:center;padding:8px;}
.board{display:grid;border:4px solid #7a7a7a;background:linear-gradient(#bdbdbd,#d6d6d6);padding:6px;border-radius:6px;}

/* Each cell */
.cell{width:var(--cell-size);height:var(--cell-size);display:inline-grid;place-items:center;background:linear-gradient(#e6e6e6,#bfbfbf);border:2px solid #fff;border-radius:4px;box-shadow: inset 2px 2px 0 rgba(255,255,255,0.7), inset -2px -2px 0 rgba(0,0,0,0.06);cursor:pointer;user-select:none;font-weight:700;font-size:16px;}
.cell.revealed{background:linear-gradient(#dcdcdc,#c4c4c4);border:1px solid #7a7a7a;box-shadow:none;cursor:default;}

/* Number colors like classic */
.cell.revealed[data-num="1"]{color:#0000ff;}
.cell.revealed[data-num="2"]{color:#007a00;}
.cell.revealed[data-num="3"]{color:#ff0000;}
.cell.revealed[data-num="4"]{color:#000084;}
.cell.revealed[data-num="5"]{color:#7a0000;}
.cell.revealed[data-num="6"]{color:#008b8b;}
.cell.revealed[data-num="7"]{color:#000000;}
.cell.revealed[data-num="8"]{color:#808080;}

/* Flag and mine visuals */
.flag{font-size:18px;color:#d40000;}
.mine{font-size:18px;}

/* Footer small notes */
.footer{font-size:12px;color:#334155;margin-top:6px;}

/* Responsive: scale board to fit available height */
.container-scale{width:100%;display:flex;justify-content:center;}
.scale-inner{max-width:100%;max-height:65vh;display:flex;align-items:center;justify-content:center;}

/* Mobile tweaks */
@media (max-width:640px){
  :root{--cell-size:34px;}
  .board-wrap{padding:12px;}
  .title{font-size:16px;}
  .reset-btn{width:40px;height:34px;font-size:18px;}
}

/* Very small screens */
@media (max-width:420px){
  :root{--cell-size:30px;}
  .scale-inner{max-height:56vh;}
}
</style>
</head>
<body>
<div class="app">
  <div class="board-wrap" role="application" aria-label="Minesweeper game">
    <div class="header" style="width:100%;justify-content:space-between;">
      <div style="display:flex;align-items:center;gap:12px;">
        <div class="title">Purin Minesweeper</div>
        <div class="control-panel" title="Change difficulty">
          <label for="difficulty" style="font-size:13px;color:#374151;">Difficulty</label>
          <select id="difficulty" class="difficulty" aria-label="Select difficulty">
            <option value="beginner">Beginner (9Ã—9, 10)</option>
            <option value="intermediate">Intermediate (16Ã—16, 40)</option>
            <option value="expert">Expert (30Ã—16, 99)</option>
            <option value="custom">Custom...</option>
          </select>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;">
        <div class="control-panel" style="gap:8px;">
          <div id="mineCount" class="led" aria-live="polite">000</div>
          <button id="reset" class="reset-btn" title="Reset game" aria-label="Reset game">ðŸ˜Š</button>
          <div id="timer" class="led" aria-live="polite">000</div>
        </div>
      </div>
    </div>

    <div class="board-area">
      <div class="container-scale">
        <div class="scale-inner">
          <div id="board" class="board" role="grid" aria-label="Minesweeper board"></div>
        </div>
      </div>
    </div>

    <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;width:100%;">
      <div class="footer">Left-click to reveal. Right-click to flag. (On touch: long-press to flag)</div>
      <div style="display:flex;gap:8px;">
        <button id="hintBtn" class="difficulty" title="Reveal a safe cell">Reveal safe</button>
        <button id="exportBtn" class="difficulty" title="Download current board as JSON">Export</button>
      </div>
    </div>
  </div>
</div>

<script>
/* Minesweeper implementation */
(() => {
  const boardEl = document.getElementById('board');
  const resetBtn = document.getElementById('reset');
  const mineCountEl = document.getElementById('mineCount');
  const timerEl = document.getElementById('timer');
  const difficultySel = document.getElementById('difficulty');
  const hintBtn = document.getElementById('hintBtn');
  const exportBtn = document.getElementById('exportBtn');

  let config = {rows:9, cols:9, mines:10};
  let grid = []; // {mine, revealed, flagged, adjacent}
  let firstClick = true;
  let interval = null;
  let seconds = 0;
  let remainingFlags = 0;
  let gameOver = false;
  let touchTimeout = null;

  const DIFFICULTIES = {
    beginner: {rows:9, cols:9, mines:10},
    intermediate: {rows:16, cols:16, mines:40},
    expert: {rows:16, cols:30, mines:99}
  };

  function setDifficulty(name) {
    if (name === 'custom') {
      const r = parseInt(prompt("Rows (5-40):", "16")) || 16;
      const c = parseInt(prompt("Cols (5-50):", "16")) || 16;
      const m = parseInt(prompt("Mines:", "40")) || 40;
      config = {rows:Math.max(5,Math.min(40,r)), cols:Math.max(5,Math.min(50,c)), mines:Math.max(1,Math.min(r*c-1,m))};
    } else {
      const d = DIFFICULTIES[name] || DIFFICULTIES.beginner;
      if (name === 'expert') config = {rows:16, cols:30, mines:99};
      else config = {...d};
    }
    applyConfig();
  }

  function applyConfig() {
    firstClick = true;
    seconds = 0;
    clearInterval(interval);
    interval = null;
    gameOver = false;
    remainingFlags = config.mines;
    updateTimer();
    updateMineCount();
    buildEmptyGrid();
    renderBoard();
    resetBtn.textContent = 'ðŸ˜Š';
  }

  function buildEmptyGrid() {
    grid = new Array(config.rows * config.cols).fill(0).map(()=>({mine:false, revealed:false, flagged:false, adjacent:0}));
  }

  function idx(r,c){ return r*config.cols + c; }
  function inBounds(r,c){ return r>=0 && c>=0 && r<config.rows && c<config.cols; }

  function placeMines(safeIndex) {
    let placed = 0;
    const total = config.rows*config.cols;
    while (placed < config.mines) {
      const i = Math.floor(Math.random()*total);
      if (i === safeIndex) continue;
      if (grid[i].mine) continue;
      const safeNeighbors = neighborsOfIndex(safeIndex);
      if (safeNeighbors.includes(i)) continue;
      grid[i].mine = true;
      placed++;
    }
    for (let r=0;r<config.rows;r++){
      for (let c=0;c<config.cols;c++){
        const i = idx(r,c);
        if (grid[i].mine) { grid[i].adjacent = -1; continue; }
        let count = 0;
        for (const n of neighborsOfIndex(i)) if (grid[n].mine) count++;
        grid[i].adjacent = count;
      }
    }
  }

  function neighborsOfIndex(i) {
    const r = Math.floor(i/config.cols);
    const c = i%config.cols;
    const arr = [];
    for (let dr=-1;dr<=1;dr++) for (let dc=-1;dc<=1;dc++){
      if (dr===0 && dc===0) continue;
      const nr=r+dr, nc=c+dc;
      if (inBounds(nr,nc)) arr.push(idx(nr,nc));
    }
    return arr;
  }

  function renderBoard() {
    boardEl.innerHTML = '';
    boardEl.style.gridTemplateColumns = `repeat(${config.cols}, var(--cell-size))`;
    boardEl.style.gridTemplateRows = `repeat(${config.rows}, var(--cell-size))`;
    boardEl.style.width = `calc(${config.cols} * var(--cell-size) + 12px)`;
    for (let r=0;r<config.rows;r++){
      for (let c=0;c<config.cols;c++){
        const i = idx(r,c);
        const cell = document.createElement('button');
        cell.className = 'cell';
        cell.setAttribute('role','button');
        cell.setAttribute('data-index', i);
        cell.setAttribute('data-r', r);
        cell.setAttribute('data-c', c);
        cell.addEventListener('click', onCellClick);
        cell.addEventListener('contextmenu', onCellRightClick);
        cell.addEventListener('touchstart', (e)=>{
          if (gameOver) return;
          touchTimeout = setTimeout(()=>{
            toggleFlag(i);
            touchTimeout = null;
          }, 500);
        }, {passive:true});
        cell.addEventListener('touchend', ()=>{
          if (touchTimeout){ clearTimeout(touchTimeout); touchTimeout = null; }
        });
        boardEl.appendChild(cell);
      }
    }
    requestAnimationFrame(()=>{
      const wrap = document.querySelector('.scale-inner');
      const maxW = wrap.clientWidth - 12;
      const maxH = window.innerHeight * 0.65;
      const cellByW = Math.floor(maxW / config.cols);
      const cellByH = Math.floor(maxH / config.rows);
      const size = Math.max(24, Math.min(cellByW, cellByH, 44));
      document.documentElement.style.setProperty('--cell-size', size + 'px');
    });
  }

  function revealAllMines(triggeredIndex) {
    for (let i=0;i<grid.length;i++){
      if (grid[i].mine){
        const cell = boardEl.querySelector(`[data-index="${i}"]`);
        if (!cell.classList.contains('revealed')){
          cell.classList.add('revealed');
          cell.innerHTML = '<span class="mine">ðŸ’£</span>';
        }
      }
    }
    if (triggeredIndex != null){
      const tr = boardEl.querySelector(`[data-index="${triggeredIndex}"]`);
      if (tr){ tr.style.background = 'linear-gradient(#f9d6d6,#f2bcbc)'; }
    }
  }

  function onCellClick(e){
    if (gameOver) return;
    const i = parseInt(this.dataset.index,10);
    if (grid[i].flagged || grid[i].revealed) return;
    if (firstClick){
      placeMines(i);
      startTimer();
      firstClick = false;
    }
    revealCell(i);
    checkWin();
  }

  function onCellRightClick(e){
    e.preventDefault();
    if (gameOver) return;
    const i = parseInt(this.dataset.index,10);
    toggleFlag(i);
    return false;
  }

  function toggleFlag(i){
    if (grid[i].revealed) return;
    grid[i].flagged = !grid[i].flagged;
    const cell = boardEl.querySelector(`[data-index="${i}"]`);
    if (grid[i].flagged) {
      cell.innerHTML = '<span class="flag">ðŸš©</span>';
      remainingFlags--;
    } else {
      cell.innerHTML = '';
      remainingFlags++;
    }
    updateMineCount();
  }

  function revealCell(i){
    if (grid[i].revealed || grid[i].flagged) return;
    grid[i].revealed = true;
    const cell = boardEl.querySelector(`[data-index="${i}"]`);
    cell.classList.add('revealed');
    if (grid[i].mine){
      cell.innerHTML = '<span class="mine">ðŸ’£</span>';
      gameOver = true;
      clearInterval(interval);
      revealAllMines(i);
      resetBtn.textContent = 'ðŸ˜µ';
      alert('Boom! You hit a mine.');
      return;
    }
    if (grid[i].adjacent > 0){
      cell.setAttribute('data-num', grid[i].adjacent);
      cell.textContent = grid[i].adjacent;
      return;
    }
    const queue = [i];
    while(queue.length){
      const cur = queue.shift();
      const neighbors = neighborsOfIndex(cur);
      for (const n of neighbors){
        if (!grid[n].revealed && !grid[n].flagged){
          grid[n].revealed = true;
          const nc = boardEl.querySelector(`[data-index="${n}"]`);
          nc.classList.add('revealed');
          if (grid[n].adjacent > 0){
            nc.setAttribute('data-num', grid[n].adjacent);
            nc.textContent = grid[n].adjacent;
          } else {
            queue.push(n);
          }
        }
      }
    }
  }

  function checkWin(){
    const total = grid.length;
    let unrevealed = 0;
    for (let i=0;i<total;i++){
      if (!grid[i].revealed) unrevealed++;
    }
    if (unrevealed === config.mines){
      gameOver = true;
      clearInterval(interval);
      resetBtn.textContent = 'ðŸ˜Ž';
      for (let i=0;i<grid.length;i++){
        if (grid[i].mine){
          const c = boardEl.querySelector(`[data-index="${i}"]`);
          c.innerHTML = '<span class="flag">ðŸš©</span>';
        }
      }
      setTimeout(()=>alert('Congratulations â€” You won!'), 80);
    }
  }

  function startTimer(){
    if (interval) return;
    interval = setInterval(()=>{ seconds++; updateTimer(); }, 1000);
  }

  function updateTimer(){ timerEl.textContent = String(seconds).padStart(3,'0'); }
  function updateMineCount(){ mineCountEl.textContent = String(Math.max(0, remainingFlags)).padStart(3,'0'); }

  resetBtn.addEventListener('click', ()=>{
    applyConfig();
  });

  difficultySel.addEventListener('change', ()=>{ setDifficulty(difficultySel.value); });

  hintBtn.addEventListener('click', ()=>{
    if (gameOver) return;
    for (let i=0;i<grid.length;i++){
      if (!grid[i].revealed && !grid[i].mine && !grid[i].flagged){
        if (firstClick){ placeMines(i); startTimer(); firstClick=false; }
        revealCell(i);
        checkWin();
        break;
      }
    }
  });

  exportBtn.addEventListener('click', ()=>{
    const data = {config,grid,seconds,firstClick};
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'minesweeper-board.json'; a.click();
    URL.revokeObjectURL(url);
  });

  document.addEventListener('keydown', (e)=>{
    if (e.key === 'F2'){ applyConfig(); }
  });

  applyConfig();
  window.addEventListener('resize', ()=>{ renderBoard(); });
})();
</script>
</body>
</html>
